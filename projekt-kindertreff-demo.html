<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Kindertreff â€“ Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <script src="https://unpkg.com/pocketbase/dist/pocketbase.umd.js"></script>

  <style>
    body {
      font-family: system-ui, sans-serif;
      max-width: 600px;
      margin: auto;
      padding: 1rem;
    }

    h1 {
      text-align: center;
    }

    form {
      display: grid;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }

    input, button {
      padding: 0.6rem;
      font-size: 1rem;
    }

    button {
      cursor: pointer;
    }

    .entry {
      padding: 0.6rem;
      margin-bottom: 0.5rem;
      border-radius: 6px;
      background: #f1f1f1;
    }

    .entry.mine {
      background: #e0f4e6;
      border-left: 4px solid #3ba55d;
    }

    .actions button {
      margin-right: 0.3rem;
    }
  </style>
</head>

<body>

<h1>Kindertreff</h1>

<p>
  Trage ein, wann dein Kind Zeit zum Spielen hat.  
  Dein Eintrag ist fÃ¼r alle sichtbar, aber <strong>nur du</strong> kannst ihn bearbeiten oder lÃ¶schen.
</p>

<form id="entryForm">
  <input id="alias" type="text" placeholder="Dein Name oder Alias" required>

  <input id="date" type="date">

  <label>Startzeit</label>
  <input id="startTime" type="time" required>

  <label>Endzeit</label>
  <input id="endTime" type="time" required>

  <button type="submit">Eintragen</button>
</form>

<div id="entries"></div>

<script>
  // ğŸ”Œ PocketBase verbinden
  const pb = new PocketBase("/api");

  const form = document.getElementById("entryForm");
  const entriesDiv = document.getElementById("entries");

  let editId = null;

  // ğŸ“¥ Eintrag speichern / aktualisieren
  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const alias = document.getElementById("alias").value.trim();
    const date = document.getElementById("date").value;
    const start = document.getElementById("startTime").value;
    const end = document.getElementById("endTime").value;

    if (!alias || !date || !start || !end) {
      alert("Bitte alle Felder ausfÃ¼llen");
      return;
    }

    localStorage.setItem("kindertreff_alias", alias);

    const data = { alias, date, start, end };

    try {
      if (editId) {
        await pb.collection("entries").update(editId, data);
        editId = null;
        form.querySelector("button").textContent = "Eintragen";
      } else {
        await pb.collection("entries").create(data);
      }

      form.reset();
      loadEntries();
    } catch (err) {
      console.error(err);
      alert("Fehler beim Speichern");
    }
  });

  // ğŸ“‹ EintrÃ¤ge laden
  async function loadEntries() {
    entriesDiv.innerHTML = "";

    const myAlias = localStorage.getItem("kindertreff_alias");

    const records = await pb.collection("entries").getFullList({
      sort: "+date,+start"
    });

    records.forEach(entry => {
      const div = document.createElement("div");
      div.className = "entry";

      if (entry.alias === myAlias) {
        div.classList.add("mine");
      }

      div.innerHTML = `
        <strong>${entry.alias}</strong><br>
        ${entry.date} | ${entry.start} â€“ ${entry.end}
        ${entry.alias === myAlias ? `
          <div class="actions">
            <button onclick="editEntry('${entry.id}')">âœï¸</button>
            <button onclick="deleteEntry('${entry.id}')">ğŸ—‘ï¸</button>
          </div>
        ` : ""}
      `;

      entriesDiv.appendChild(div);
    });
  }

  // âœï¸ Bearbeiten
  async function editEntry(id) {
    const entry = await pb.collection("entries").getOne(id);

    document.getElementById("alias").value = entry.alias;
    document.getElementById("date").value = entry.date;
    document.getElementById("startTime").value = entry.start;
    document.getElementById("endTime").value = entry.end;

    editId = id;
    form.querySelector("button").textContent = "Ã„nderung speichern";
  }

  // ğŸ—‘ï¸ LÃ¶schen
  async function deleteEntry(id) {
    if (!confirm("Willst du deinen Eintrag wirklich lÃ¶schen?")) return;

    await pb.collection("entries").delete(id);
    loadEntries();
  }

  // ğŸš€ Initial laden
  loadEntries();
</script>

</body>
</html>

