<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Kindertreff</title>

<style>
:root{
  --bg:#f6f7f8; --surface:#fff; --text:#1f2933;
  --muted:#6b7280; --accent:#4f6ef7;
  --border:#e5e7eb; --radius:14px;
  --own:#e8ecff;
}

body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
}

header{
  background:var(--surface);
  border-bottom:1px solid var(--border);
  padding:1.2rem;
  text-align:center;
}

main{
  max-width:760px;
  margin:auto;
  padding:1.5rem 1rem 4rem;
}

.card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:1rem;
  margin-bottom:1.2rem;
}

form{
  display:grid;
  gap:0.75rem;
}

label{
  font-size:0.75rem;
  color:var(--muted);
}

input, select, button{
  font-family:inherit;
  padding:0.6rem;
  border-radius:10px;
  border:1px solid var(--border);
}

.time-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:0.75rem;
}

button{
  background:var(--accent);
  color:white;
  border:none;
  cursor:pointer;
}

#week{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:1rem;
}

@media(max-width:900px){#week{grid-template-columns:repeat(2,1fr);}}
@media(max-width:600px){#week{grid-template-columns:1fr;}}

.day{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:12px;
  padding:1rem;
}

.day h3{
  font-size:0.85rem;
  color:var(--muted);
  margin:0 0 0.5rem;
}

.entry{
  border:1px solid var(--border);
  border-radius:10px;
  padding:0.5rem;
  margin-bottom:0.4rem;
  background:#fafafa;
}

.entry.own{background:var(--own);}
.entry.expired{opacity:0.45;text-decoration:line-through;}

.entry button{
  margin-top:0.3rem;
  font-size:0.75rem;
  background:transparent;
  color:var(--muted);
  border:1px solid var(--border);
}

footer{
  text-align:center;
  font-size:0.75rem;
  color:var(--muted);
  padding:2rem 1rem;
}
</style>
</head>

<body>

<header>
<h1>Kindertreff</h1>
<p style="font-size:0.85rem;color:var(--muted);max-width:600px;margin:auto;">
Trage ein, wann dein Kind Zeit zum Spielen hat.  
Alle sehen die Woche – nur du kannst deinen Eintrag löschen.
</p>
</header>

<main>

<div class="card">
<form id="entryForm">
<input id="name" placeholder="Name des Kindes" required>

<select id="group">
<option>Kindi</option>
<option>Turnen</option>
<option>Musik</option>
<option>Sonstiges</option>
</select>

<label>Datum (tippen oder Kalender)</label>
<input id="date" type="date" required>

<div class="time-grid">
<div>
<label>Start</label>
<input id="start" type="time" required>
</div>
<div>
<label>Ende</label>
<input id="end" type="time" required>
</div>
</div>

<input id="note" placeholder="Ort / Hinweis (optional)">
<button type="submit">Eintragen</button>
</form>
</div>

<h2>Diese Woche</h2>
<div id="week"></div>

</main>

<footer>
Keine Anmeldung · Daten werden automatisch bereinigt
</footer>

<script src="https://unpkg.com/pocketbase/dist/pocketbase.umd.js"></script>
<script>
const pb = new PocketBase("/api");

/* lokaler Nutzer */
let userId = localStorage.getItem("ktUser");
if(!userId){
  userId = crypto.randomUUID();
  localStorage.setItem("ktUser", userId);
}

/* Woche vorbereiten */
const weekEl = document.getElementById("week");
const today = new Date(); today.setHours(0,0,0,0);
const days = {};

for(let i=0;i<7;i++){
  const d=new Date(today);
  d.setDate(today.getDate()+i);
  const key=d.toISOString().split("T")[0];

  const el=document.createElement("div");
  el.className="day";
  el.innerHTML=`<h3>${i===0?"Heute":i===1?"Morgen":d.toLocaleDateString("de-DE",{weekday:"short",day:"numeric",month:"numeric"})}</h3><small>Keine Einträge</small>`;
  weekEl.appendChild(el);
  days[key]=el;
}

/* Laden */
async function load(){
  Object.values(days).forEach(d=>d.querySelectorAll(".entry").forEach(e=>e.remove()));

  let entries=[];
  try{
    entries=await pb.collection("entries").getFullList({sort:"date,start"});
  }catch{return;}

  entries.forEach(e=>{
    const day=days[e.date];
    if(!day) return;

    day.querySelector("small")?.remove();

    const expired=new Date(e.date+"T"+e.end)<new Date();
    const div=document.createElement("div");
    div.className="entry"+(expired?" expired":"")+(e.localUserId===userId?" own":"");
    div.innerHTML=`
<strong>${e.name}</strong><br>
${e.start}–${e.end}<br>
<small>${e.group}${e.note?" · "+e.note:""}</small>
${e.localUserId===userId?`<br><button data-id="${e.id}">Löschen</button>`:""}
`;
    day.appendChild(div);
  });

  document.querySelectorAll("button[data-id]").forEach(b=>{
    b.onclick=async()=>{
      if(confirm("Eintrag wirklich löschen?")){
        await pb.collection("entries").delete(b.dataset.id);
        load();
      }
    };
  });
}

/* Formular */
document.getElementById("entryForm").onsubmit = async e => {
  e.preventDefault();

  const nameEl = document.getElementById("name");
  const groupEl = document.getElementById("group");
  const dateEl = document.getElementById("date");
  const startEl = document.getElementById("start");
  const endEl = document.getElementById("end");
  const noteEl = document.getElementById("note");

  const alias = nameEl.value.trim();
  if (!alias) {
    alert("Bitte einen Namen eingeben.");
    return;
  }

  await pb.collection("entries").create({
    name: alias,
    group: groupEl.value,
    date: dateEl.value,
    start: startEl.value,
    end: endEl.value,
    note: noteEl.value,
    localUserId: userId
  });

  e.target.reset();
  load();
};

</script>

</body>
</html>


